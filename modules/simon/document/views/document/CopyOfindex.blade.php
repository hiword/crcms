<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Kaijia</title>
	<!-- media queries -->
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0" />

<link rel='stylesheet' id='yarppWidgetCss-css'  href='{{static_asset("static/wordpress/wp-content/plugins/yet-another-related-posts-plugin/style/widget.css")}}' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-css'  href='{{static_asset("static/wordpress/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css")}}' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-familiar-css'  href='{{static_asset("static/wordpress/wp-content/plugins/crayon-syntax-highlighter/themes/familiar/familiar.css")}}' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-consolas-css'  href='{{static_asset("static/wordpress/wp-content/plugins/crayon-syntax-highlighter/fonts/consolas.css")}}' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='{{static_asset("static/wordpress/wp-content/plugins/contact-form-7/includes/css/styles.css")}}' type='text/css' media='all' />
<link rel='stylesheet' id='style-css'  href='{{static_asset("static/wordpress/wp-content/themes/fixed/style.css")}}' type='text/css' media='all' />
<link rel='stylesheet' id='opensans-css-css'  href='{{static_asset("static/wordpress/wp-content/themes/fixed/includes/fonts/opensans/opensans.css")}}' type='text/css' media='screen' />
<link rel='stylesheet' id='font-awesome-css-css'  href='{{static_asset("static/wordpress/wp-content/themes/fixed/includes/fonts/fontawesome/font-awesome.css")}}' type='text/css' media='screen' />
<link rel='stylesheet' id='fixed-media-queries-css-css'  href='{{static_asset("static/wordpress/wp-content/themes/fixed/media-queries.css")}}' type='text/css' media='screen' />
<link rel='stylesheet' id='fixed-flexslider-css-css'  href='{{static_asset("static/wordpress/wp-content/themes/fixed/includes/styles/flexslider.css")}}' type='text/css' media='screen' />
<script type='text/javascript' src="{{static_asset('static/common/js/jquery-2.1.3.min.js')}}"></script>


<body class="home blog fixed-bg">
	
			<a id="drawer-toggle" href="#" title="drawer toggle"><i class="icon-windows"></i></a>
		
	<header class="header">
		<!-- grab the logo and site title -->
			<h1 class="logo-image">
				<a href="http://www.kaijia.me" title="Kaijia">
					<img class="logo" src="http://data.kaijia.me/2013/10/logo-small.png" alt="Kaijia" />
				</a>
			</h1>
			
			<h2 class="logo-subtitle">Building the Coming Soon</h2>
	    	    
	    <nav role="navigation" class="header-nav">  	
	    	<!-- nav menu -->
	    	<div class="menu-main-header-container"><ul id="menu-main-header" class="nav"><li id="menu-item-378" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-378"><a href="http://www.kaijia.me">首页</a></li><li id="menu-item-892" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-892"><a href="http://www.kaijia.me/sandbox/">实验室</a></li><li id="menu-item-837" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-837"><a href="http://www.kaijia.me/archive/">归档</a></li><li id="menu-item-283" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-283"><a href="http://www.kaijia.me/contact/">联系我</a></li></ul></div>	    	
	    		    		<a id="drawer-toggle2" href="#" title="drawer toggle"><i class="icon-windows"></i></a>
	    		    </nav>	
	    
	    <div class="widgets">
	    	<div id="text-2" class="widget widget_text"><h2 class="widgettitle">关于</h2>
			<div class="textwidget"><!--<a href="http://kaijia.me/renren"><img alt="Kaijia's Gravatar" src="http://www.gravatar.com/avatar/baad98b7d8813c81f180e93faff6132a?s=64&d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D64&r=G" class="avatar avatar-64 photo" style="margin-top: 3px; padding: 0 0.5em 0 0; float: left" height="64" width="64"></a>-->
<strong><a href="http://kaijia.me/renren" style="color: #555;">Kaijia</a></strong> graduated from <a href="https://zh.wikipedia.org/wiki/%E6%9D%AD%E5%B7%9E%E5%A4%96%E5%9B%BD%E8%AF%AD%E5%AD%A6%E6%A0%A1" style="color: #555;">the Akademia</a>. He is always proud to be a HFLSer!
<!--<div style="margin-top: 6px;"> 
<div class="g-follow" data-annotation="none" data-height="24" data-href="//plus.google.com/118089803383975680755" data-rel="author"></div>
</div>--></div>
		</div><div id="search-2" class="widget widget_search"><form action="http://www.kaijia.me/" class="search-form clearfix">
	<fieldset>
		<input type="text" class="search-form-input text" name="s" onfocus="if (this.value == '搜索...') {this.value = '';}" onblur="if (this.value == '') {this.value = '搜索...';}" value="搜索..."/>
		<input type="submit" value="Search" class="submit search-button" />
	</fieldset>
</form></div><div id="ok-icons-widget-2" class="widget icons">		
				
		<div class="icons-widget">
					
			<div id="icons" class="icons-rounded">
								
								
												
					<a href="https://www.facebook.com/kaijia.feng" class="facebook-icon" title="Facebook"><i class="icon-facebook"></i></a>
								
								
								
												
					<a href="http://cn.linkedin.com/pub/kaijia-feng/58/b41/5b6" class="linkedin-icon" title="LinkedIn"><i class="icon-linkedin"></i></a>
								
								
												
					<a href="https://plus.google.com/118089803383975680755?rel=author" class="google-icon" title="Google"><i class="icon-gplus"></i></a>
								
												
					<a href="http://www.kaijia.me/feed/" class="feed-icon" title="RSS Feed"><i class="icon-rss"></i></a>
								
								
				
				
							</div>		
		</div>			
			
			</div>	    </div>	
    
	</header>
	
	<div id="wrapper">
		<div id="main">		
		<div id="content">
			<div class="posts">
	
				<!-- titles -->
								
				<!-- grab the posts -->
								
				<article class="post post-1447 type-post status-publish format-standard hentry category-linux tag-mysql">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2015/10/mysql-show-procedure-code-without-debug-mode/" title="非调试模式下查看MySQL过程代码">非调试模式下查看MySQL过程代码</a></h2>
																		<div class="date-title">10/20/2015</div>
								</header>
							
																	<p>添加MySQL过程时间长了，难免会有需要查看过程代码的情况。比如Kaijia有一个过程自动清理数据库中大于指定时间的分区，这次Kaijia把这个指定的时间忘了，于是想通过查看过程的代码找回这个设定的时间。</p>
<p>根据MySQL文档，可以使用“<em><a href="https://dev.mysql.com/doc/refman/5.6/en/show-procedure-code.html" target="_blank">SHOW PROCEDURE CODE</a></em>”语法查看过程和自定义函数的代码，但Kaijia在执行此语法时却遇到了以下错误：</p>
<blockquote><p>mysql&gt; SHOW PROCEDURE CODE <code>Kaijia的过程</code>;<br />
ERROR 1289 (HY000): The &#8216;SHOW PROCEDURE|FUNCTION CODE&#8217; feature is disabled; you need MySQL built with &#8216;&#8211;with-debug&#8217; to have it working</p></blockquote>
<p>阅读此语法的文档Kaijia找到了相关提示：此扩展仅在编译时开启了调试模式的服务器中可用（This statement is a MySQL extension that is available only for servers that have been built with debugging support.）。而考虑到除了MySQL开发外，一般情况下使用的由软件包管理器（<em>YUM</em>和<em>APT-GET</em>）提供的MySQL预编译版均没有开启编译模式，这条命令对广大开发者和系统管理员来说基本上是没法用的……</p>
<p> <a href="http://www.kaijia.me/2015/10/mysql-show-procedure-code-without-debug-mode/#more-1447" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/linux/" rel="category tag">Linux</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/mysql/" rel="tag">MySQL</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2015/10/mysql-show-procedure-code-without-debug-mode/#comments-title" title="comments">无评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1438 type-post status-publish format-standard hentry category-linux tag-ubuntu tag-ssh tag-centos">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2015/09/regenerate-ssh-host-key-server-side/" title="重新生成SSH服务器端密钥方法">重新生成SSH服务器端密钥方法</a></h2>
																		<div class="date-title">09/20/2015</div>
								</header>
							
																	<p>理论上来说，每次安装服务器时SSH密钥（SSH Host Key）都是自动生成的，而生成出相同密钥的概率接近于0，这样避免了中间攻击等情况。但是，就是存在以下情况使得两台SSH密钥相同：</p>
<ul>
<li>在虚拟化技术中克隆了一台虚拟机；</li>
<li>将原来的虚拟硬盘复制后新建虚拟机运行。</li>
</ul>
<p>当然还有其他更加坑爹的情况，比如Kaijia碰到的VPS云服务器重装系统复制完模板数据后不重新生成SSH密钥的（某国内主流云提供商……），于是整个云平台所有的VPS都跑着相同的SSH密钥，如果要实现中间攻击只需要新建一台云就能获得私钥了。正是因为碰到了这种云主机，Kaijia研究了一下如何重新生成SSH服务器端密钥。</p>
<p> <a href="http://www.kaijia.me/2015/09/regenerate-ssh-host-key-server-side/#more-1438" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/linux/" rel="category tag">Linux</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/ubuntu/" rel="tag">Ubuntu</a> <a href="http://www.kaijia.me/tag/ssh/" rel="tag">SSH</a> <a href="http://www.kaijia.me/tag/centos/" rel="tag">CentOS</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2015/09/regenerate-ssh-host-key-server-side/#comments-title" title="comments">无评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1395 type-post status-publish format-standard hentry category-linux tag-apt-get tag-dialog">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2015/09/unable-to-initialize-frontend-dialog-issue-solved/" title="无法初始化前端界面Dialog工具问题解决">无法初始化前端界面Dialog工具问题解决</a></h2>
																		<div class="date-title">09/18/2015</div>
								</header>
							
																	<p>其实这个问题Kaijia还碰到很久了，而且搜了一下网上并没有相关的中文资料，所以还是记录一下，希望可以帮之后遇到相同问题的朋友节省时间。</p>
<p>Kaijia之前在一些安装有精简版Ubuntu 14.04模板（例如<em>ubuntu-14.04-x86_64-minimal</em>）的OpenVZ VPS上使用<em>apt-get</em>安装软件时经常碰到以下提示：</p>
<blockquote><p>debconf: unable to initialize frontend: Dialog<br />
debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76.)<br />
debconf: falling back to frontend: Readline</p></blockquote>
<p>或者在中文Locale下面：</p>
<blockquote><p>debconf: 无法初始化前端界面：Dialog<br />
debconf: (没有安装任何可用的对话框类程序，所以无法使用基于此种形式的界面。 at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76.)<br />
debconf: 返回前端界面：Readline</p></blockquote>
<p>由于这个错误提示并不会影响安装，于是Kaijia一开始也没有在意。</p>
<p> <a href="http://www.kaijia.me/2015/09/unable-to-initialize-frontend-dialog-issue-solved/#more-1395" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/linux/" rel="category tag">Linux</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/apt-get/" rel="tag">apt-get</a> <a href="http://www.kaijia.me/tag/dialog/" rel="tag">Dialog</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2015/09/unable-to-initialize-frontend-dialog-issue-solved/#comments-title" title="comments">无评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1429 type-post status-publish format-standard hentry category-study tag-jetbrains tag-intellij-idea">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2015/09/intellij-idea-software-family-keep-indents-tab-at-empty-line-prevent-removal-method/" title="Intellij IDEA系列软件保留空行缩进避免自动删除方法">Intellij IDEA系列软件保留空行缩进避免自动删除方法</a></h2>
																		<div class="date-title">09/17/2015</div>
								</header>
							
																	<p>自从Kaijia申请到JetBrains的学生优惠开始用Intellij IDEA系列的软件就感觉再也回不去Netbeans了，这一系列在整体性能，尤其是在代码自动完成这个功能上要比Netbeans领先起码一两年。现在Kaijia已经将几乎全部的代码迁移到了Intellij IDEA系列中。不过随之而来的一些小问题也出现了。</p>
<p>在Netbeans中，默认所有的空行都是保留缩进的，缩进的量根据上下文的缩进量确定。而在Intellij中，默认所有的空行都是没有缩进的，所有增加的缩进Tab都会在文件保存时被自动删除。这样设置确也有好处，比如统计行数时不需要考虑Tab和空格、在<em>nano</em>中显示时可以避免绿色条柱等等，但是对于以往在Netbeans中编辑的项目，迁移到Intellij后，这些使用习惯的改变势必会对原有的开发规范造成影响。</p>
<p>Kaijia就经常需要用其他软件手动去增加缩进。在Intellij的设置里面搜索了一下发现控制此行为的选项粗看只有“<em>Keep indents at empty lines</em>”（空行保留缩进）一项，激活这一项后实际上并没有效果，缩进只会在光标所在的行被保留；光标移开到其他行后，只要按下强制保存键（Ctrl+S），原来空行的缩进立马就被删除了。</p>
<p> <a href="http://www.kaijia.me/2015/09/intellij-idea-software-family-keep-indents-tab-at-empty-line-prevent-removal-method/#more-1429" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/" rel="category tag">学习</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/jetbrains/" rel="tag">JetBrains</a> <a href="http://www.kaijia.me/tag/intellij-idea/" rel="tag">Intellij IDEA</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2015/09/intellij-idea-software-family-keep-indents-tab-at-empty-line-prevent-removal-method/#comments-title" title="comments">无评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1420 type-post status-publish format-standard hentry category-wordpress tag-mysql">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2015/09/wordpress-admin-role-submit-for-review-cannot-post-issue-solution/" title="WordPress管理员权限“提请审批”无法发布文章问题解决方法">WordPress管理员权限“提请审批”无法发布文章问题解决方法</a></h2>
																		<div class="date-title">09/07/2015</div>
								</header>
							
																	<p>之前Kaijia一个WordPress站点安装了一个神一般的插件（具体造成错误的代码怎是没空找就不点名了……）后突然之间所有的帐号均无法发布文章了，并且自动保存等功能也不可用。即使Kaijia使用管理员帐号登录发布文章仍然显示“提请审批”，并且无法显示状态、公开度信息，点击“提请审批”之后会弹出错误提示页面不存在。其他的功能，例如下载等，也无法添加。</p>
<div id="attachment_1421" style="width: 640px" class="wp-caption aligncenter"><a href="http://data.kaijia.me/2015/09/wordpress-submit-for-review-error-compare.png"><img class="size-full wp-image-1421" src="http://data.kaijia.me/2015/09/wordpress-submit-for-review-error-compare.png" alt="正常情况编辑文章右栏（左侧）和Kaijia遇到的异常情况（右侧）比较" width="630" height="410" srcset="http://data.kaijia.me/2015/09/wordpress-submit-for-review-error-compare-300x195.png 300w, http://data.kaijia.me/2015/09/wordpress-submit-for-review-error-compare.png 630w" sizes="(max-width: 630px) 100vw, 630px" /></a><p class="wp-caption-text">正常情况编辑文章右栏（左侧）和Kaijia遇到的异常情况（右侧）比较</p></div>
<p>Kaijia很快排除了权限系统出错的可能性，因为Kaijia登录的是管理员帐号，管理员权限与权限系统平行，<strong>始终</strong>获得所有权限，使用诸如<em>User Role Editor</em>等插件调整权限系统均不会管理员权限造成影响。</p>
<p> <a href="http://www.kaijia.me/2015/09/wordpress-admin-role-submit-for-review-cannot-post-issue-solution/#more-1420" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/wordpress/" rel="category tag">WordPress</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/mysql/" rel="tag">MySQL</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2015/09/wordpress-admin-role-submit-for-review-cannot-post-issue-solution/#comments-title" title="comments">1 篇评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1407 type-post status-publish format-standard hentry category-linux tag-ssh">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2015/09/ssh-channel-open-failed-connect-failed-connection-timed-out-issue-solved/" title="SSH Channel“open failed: connect failed: Connection timed out”问题解决">SSH Channel“open failed: connect failed: Connection timed out”问题解决</a></h2>
																		<div class="date-title">09/07/2015</div>
								</header>
							
																	<p>在Hyper-V的虚拟机里面运行Linux网络性能果真要比KVM差一些，当然此间原因很多：驱动、NAT转换效率等等。这次Kaijia遇到的大量“open failed: connect failed: Connection timed out”问题，最后看来也是连接性能原因。</p>
<p>Kaijia用SSH转Socket连接到不同地区的IP，然后进行检测和数据采集，同时所有连接同时有流量传输，一开始一切正常，但是Socket运行时间久后就会慢慢出现“open failed: connect failed: Connection timed out”错误提示。于是Kaijia开启调试模式分析了一下错误信息，看到了很多类似以下的信息：</p>
<blockquote><p>debugx: channel x: open confirm rwindow ?? rmax ??<br />
channel x: open failed: connect failed: Connection timed out<br />
debugx: channel x: free: direct-tcpip: listening port xxxxx for xxx.xxx.xxx.xxx port 80, connect from 172.16.1.xxx port xxxxx to 172.16.1.xxx port xxxxx, nchannels x<br />
debugx: channel x: zombie<br />
debugx: channel x: garbage collecting<br />
debugx: channel x: read failed<br />
debugx: channel x: close_read<br />
debugx: channel x: input open -&gt; drain<br />
debugx: channel x: ibuf empty<br />
debugx: channel x: send eof<br />
debugx: channel x: input drain -&gt; closed</p></blockquote>
<p>结合错误提示，网上搜了一些，很好理解即连接在允许的时间内没有收到任何信息，于是发送了EOF结束，返回了连接超时错误，因此可以说是连接的性能问题。根本上解决问题是比较困难的，涉及到很多方面因素，比较现实的解决方法便是延长等待时间，避免连接超时（Timeout）以增加收到数据包的概率。</p>
<p> <a href="http://www.kaijia.me/2015/09/ssh-channel-open-failed-connect-failed-connection-timed-out-issue-solved/#more-1407" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/linux/" rel="category tag">Linux</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/ssh/" rel="tag">SSH</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2015/09/ssh-channel-open-failed-connect-failed-connection-timed-out-issue-solved/#comments-title" title="comments">无评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1409 type-post status-publish format-standard hentry category-linux tag-mysql">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2015/09/mysql-command-line-operation-limit-single-selected-database/" title="MySQL命令行操作限定单个数据库方法">MySQL命令行操作限定单个数据库方法</a></h2>
																		<div class="date-title">09/06/2015</div>
								</header>
							
																	<p>写这篇文章的原因出自Kaijia一次被<a href="http://stackoverflow.com/" target="_blank">Stack Overflow</a>坑的经历，回头看来虽然Stack Exchange的Peer Review机制很好，但是错误照样还是很多的，以及Kaijia提交了Edit被Peer Review拒绝了……</p>
<p>之前某个插件神不知鬼不觉地删除了所有WordPress数据表的主键和自增，导致系统出现异常，如果手动恢复的话要处理近30余张主键规则不同的表非常麻烦，于是Kaijia决定采用数据恢复的方式，即先将现有数据导出并删除表，再导入数据库备份重建表结构，再将现有数据导入。这样一来数据是现有的数据，表结构是损坏前的正确结构完成修复。</p>
<p>按照这个步骤下去，第二步是导入备份，但是Kaijia的数据库备份是全数据库整盘备份，单个SQL文件里面包含了所有数据库的数据，而本次恢复涉及单个数据库，不能影响其他数据库。之前没有类似经验无从下手，于是Kaijia搜索了下找到了此篇Stack Overflow问题《<a href="https://stackoverflow.com/questions/1013852/can-i-restore-a-single-table-from-a-full-mysql-mysqldump-file/16214902" target="_blank">Can I restore a single table from a full mysql mysqldump file?</a>》，高票回答是使用<em>sed</em>命令（完全正确），但是显然没有后面的正面<a href="http://stackoverflow.com/a/16214902/5279266" target="_blank">回答</a>（后来证实是坑）方便。后面回答的要旨非常简单：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-566a60c91655e505160328" class="crayon-syntax crayon-theme-familiar crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 18px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 18px !important;">
mysql -u root -p 限定数据库 &lt; dump.sql</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 18px !important;"><div class="crayon-num" data-line="crayon-566a60c91655e505160328-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 18px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-566a60c91655e505160328-1"><span class="crayon-v">mysql</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">u</span><span class="crayon-h"> </span><span class="crayon-v">root</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">p</span><span class="crayon-h"> </span>限定数据库<span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">dump</span><span class="crayon-e">.sql</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>在<em>mysql</em>命令最后加上指定的数据库名便可以了！这不科学！但鉴于此答案有还有人点赞，还有人评论“This is what most people need.”于是Kaijia就尝试了……结果<strong>果真其他的数据库都被还原了</strong>，当然幸亏操作前Kaijia给服务器快照了一下，直接恢复了。</p>
<p> <a href="http://www.kaijia.me/2015/09/mysql-command-line-operation-limit-single-selected-database/#more-1409" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/linux/" rel="category tag">Linux</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/mysql/" rel="tag">MySQL</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2015/09/mysql-command-line-operation-limit-single-selected-database/#comments-title" title="comments">无评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1399 type-post status-publish format-standard hentry category-linux tag-linux-kernel">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2015/09/file-handles-limit-accept-too-many-open-files-issue-solved/" title="文件句柄限制造成“accept: Too many open files”问题解决">文件句柄限制造成“accept: Too many open files”问题解决</a></h2>
																		<div class="date-title">09/04/2015</div>
								</header>
							
																	<p>由于数据采集需要，而且流量并不大，不需要使用分布式爬虫，Kaijia使用使用一台服务器同时连接近百个SSH并生成Socket处理采集需求，一开始运行的相当流畅，但是大约数小时后终端便开始不停地弹出“accept: Too many open files”报错。</p>
<p>于是便简单地使用<em>lsof</em>命令查看了单个SSH进程使用的文件句柄数量：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-566a60c9168c8136564208" class="crayon-syntax crayon-theme-familiar crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 16px !important; line-height: 18px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 16px !important;height: 24px !important; line-height: 24px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 22.4px !important; line-height: 22.4px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 16px !important; line-height: 18px !important;">
lsof -p {PID}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 16px !important; line-height: 18px !important;"><div class="crayon-num" data-line="crayon-566a60c9168c8136564208-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 18px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-566a60c9168c8136564208-1"><span class="crayon-e">lsof</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-e">p</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">PID</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>结果发现单个SSH比预想中的文件句柄使用率要多很多，连接繁忙（例如并发）的时候可以达到两三百，一般情况下只要Socket有数据传输就可能打开一百个文件句柄。考虑到同时运行的Socket数量较多，同时存在的文件句柄数量可能会超过Linux系统设置的上限，造成“accept: Too many open files”问题。</p>
<p> <a href="http://www.kaijia.me/2015/09/file-handles-limit-accept-too-many-open-files-issue-solved/#more-1399" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/linux/" rel="category tag">Linux</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/linux-kernel/" rel="tag">Linux Kernel</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2015/09/file-handles-limit-accept-too-many-open-files-issue-solved/#comments-title" title="comments">无评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1362 type-post status-publish format-standard hentry category-windows tag-edius">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2014/11/edius-multi-camera-editing-slow-issue-solved/" title="EDIUS多机位编辑卡顿问题解决">EDIUS多机位编辑卡顿问题解决</a></h2>
																		<div class="date-title">11/19/2014</div>
								</header>
							
																	<p>更新了很多编程相关的内容，作为技术宅也稍微写点其他技术方面的文章。在杭外时，Kaijia笔记本上的EDIUS还是运行得相当流畅的，处理多机位时也不会出现卡顿等问题。但2年多过去了，Kaijia笔记本的性能可以说是“每况愈下”，已经几乎只能拿来编程了。</p>
<p>现在Kaijia有时用EDIUS编辑多机位（尤其是三机位以上）的视频基本上都是一顿一顿得进行的。这个问题基本上可以归因为两种：Windows系统效率降低；视频质量的提升。以前Kaijia使用的素材基本上都在720P以下，码率很少有超过10M的。现在手机都能清楚1080P甚至4K全高清摄像，码率可以高达30M。而Kaijia的笔记本硬件也没有更新，处理器性能自然无法跟上要求。</p>
<p> <a href="http://www.kaijia.me/2014/11/edius-multi-camera-editing-slow-issue-solved/#more-1362" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/windows/" rel="category tag">Windows</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/edius/" rel="tag">EDIUS</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2014/11/edius-multi-camera-editing-slow-issue-solved/#comments-title" title="comments">2 篇评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
								
				<article class="post post-1337 type-post status-publish format-standard hentry category-linux tag-php-cgi tag-vestacp">
				
					<!-- uses the post format -->
										<!-- grab the video -->
										
						<!-- grab the featured image -->
											
										
					<div class="box-wrap">
						<div class="box">
							<!-- post content -->
							<div class="post-content">
								<header>
														
										<h2 class="entry-title"><a href="http://www.kaijia.me/2014/11/vestacp-php-cgi-too-many-processes-threads-memory-issue-solved/" title="VestaCP面板PHP-CGI进程过多耗尽内存问题解决">VestaCP面板PHP-CGI进程过多耗尽内存问题解决</a></h2>
																		<div class="date-title">11/18/2014</div>
								</header>
							
																	<p>就像Kaijia在<a title="Ubuntu 14.04系统VestaCP面板MySQL无法正常运行问题解决" href="http://www.kaijia.me/2014/11/ubuntu-14-04-vestacp-mysql-not-work-issue-solved/">上一篇文章</a>中提到的一样，VestaCP面板对较新发布的系统支持并不理想，到现在对Ubuntu 14.04的支持只能说是勉强能正常运行，还没有得到很好的优化，而对Redhat/CentOS 7的支持则完全还没开始。在Ubuntu 14.04系统中，VestaCP面板的部分设置仍有调整优化的空间，Kaijia这次就遇到的PHP-CGI进程耗尽内存的情况就是由于配置未优化造成的。</p>
<p>Kaijia的VestaCP模块（Package）设置使用的是<em>phpfcgid</em>模板，这样可以通过PHP-CGI模块有效得实现站点间文件访问的阻隔。但这样做的代价是每个Unix用户都会拥有自己的FCGI实例，因此需要支出额外的内存。当配置失当时更会造成虽然服务器访问量低但内存接近耗尽的情况，使用<em>htop</em>等工具查看有如下图：</p>
<div id="attachment_1358" style="width: 310px" class="wp-caption aligncenter"><a href="http://data.kaijia.me/2014/11/vestacp-htop-php-cgi-high-memory-usage.png"><img class="size-medium wp-image-1358" src="http://data.kaijia.me/2014/11/vestacp-htop-php-cgi-high-memory-usage-300x227.png" alt="HTOP显示PHP-CGI大量进程占用内存情况" width="300" height="227" srcset="http://data.kaijia.me/2014/11/vestacp-htop-php-cgi-high-memory-usage-300x227.png 300w, http://data.kaijia.me/2014/11/vestacp-htop-php-cgi-high-memory-usage.png 866w" sizes="(max-width: 300px) 100vw, 300px" /></a><p class="wp-caption-text">HTOP显示PHP-CGI大量进程占用内存情况</p></div>
<p>虽然Kaijia放在VestaCP服务器上的网站P/V很低，但大量的PHP-CGI进程仍然在服务器重启后数小时内基本耗尽了内存，很早之前闲置的PHP-CGI进程没有被杀死，一个进程下面运行了近20个子进程消耗了至少100M的内存。造成这一现象的原因既是VestaCP在Ubuntu的<em>phpfcgid</em>模板中使用了未优化的配置。</p>
<p> <a href="http://www.kaijia.me/2014/11/vestacp-php-cgi-too-many-processes-threads-memory-issue-solved/#more-1337" class="more-link">阅读更多</a></p>
									
																								</div><!-- post content -->
							
															<ul class="meta">
									<li><span>分类</span> <a href="http://www.kaijia.me/category/study/linux/" rel="category tag">Linux</a></li>
																			<li><span>标签</span> <a href="http://www.kaijia.me/tag/php-cgi/" rel="tag">PHP-CGI</a> <a href="http://www.kaijia.me/tag/vestacp/" rel="tag">VestaCP</a></li>
																		<li><span>评论</span> <a href="http://www.kaijia.me/2014/11/vestacp-php-cgi-too-many-processes-threads-memory-issue-solved/#comments-title" title="comments">无评论</a></li>
									<li><span>知识共享许可</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/"><img alt="知识共享许可" style="border-width: 0; margin-top: 4px;" src="http://www.kaijia.me/wp-content/themes/fixed/images/cc-by-nc-nd.png" /></a></li>
								</ul>
														
						</div><!-- box -->
					</div><!-- box wrap -->
				</article><!-- post-->	
				
											</div>
			
			<!-- post navigation -->
				
				<div class="post-nav infinite">
					<div class="post-nav-inside">
						<div class="post-nav-left"></div>
						<div class="post-nav-right"><a href="http://www.kaijia.me/page/2/" >较旧文章 <i class="icon-arrow-right"></i></a></div>	
					</div>
				</div>
						
			<!-- comments -->
					</div><!-- content -->
	
		<!-- footer -->
				</div><!-- main -->
	</div><!-- wrapper -->
	
	<div class="clearfix"></div>
	<div class="copyright">&copy; 2012-2015 <a href="http://www.kaijia.me">Kaijia Feng</a> | Proudly powered by WordPress</div>
</body>
</html>
<!-- Dynamic page generated in 0.568 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2015-12-11 13:36:09 -->

<!-- super cache -->