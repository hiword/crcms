<!DOCTYPE html>
<html ng-app="app">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../vendor/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="static/css/basic.css" />
<!-- 可选的Bootstrap主题文件（一般不用引入） -->
<link rel="stylesheet" href="../vendor/bootstrap/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="vendor/font-awesome/4.5.0/css/font-awesome.min.css" />
<title>Insert title here</title>
</head>
<body>
<div class="main-left pull-left">
	<div class="left-top">
		<h1 class="logo"><a href="###">CRCMS</a></h1>
		<div class="meta meta-1">致力于打造全面化的开源CMS系统</div>
		<div class="meta meta-2">记录我的生活，我的经验和笔记</div>
		<div class="meta meta-3"></div>
	</div>
	<div class="left-bottom">
		<p>
			<a href="###"><i class="fa fa-qq fa-lg"></i></a>
			<a href="###" class="ml10"><i class="fa fa-github fa-lg"></i></a>
			<a href="###" class="ml10"><i class="fa fa-envelope fa-lg"></i></a>
		</p>
		<p>
			Copyright <!-- © --><i class="fa fa-copyright"></i> 2013-2014
		</p>
	</div>
</div>
<div class="main-right pull-right">
	<div class="articles" ng-controller="listController">
	{{tags = ddddd}}
		<article ng-repeat="list in lists">
			<a class="title" href="###">{{list.title}}</a>
			<div class="content"> 
				1.梁实秋说：你走，我不送你。你来，无论多大风多大雨，我要去接你。 2.海明威说：优于别人，并不高贵，真正的高贵应该是优于过去的自己。 3.三毛说：如果有来生，要做一棵树，站成永恒，没有悲伤的姿势：一半在尘土里安详，一半在空中飞扬；一半散落阴凉，一半沐浴阳光。非常沉默非常骄傲，从不依靠从不寻找。 4.顾漫...
			</div>
			<div class="article-info mt10 mb10">
				<span>
					<i class="glyphicon glyphicon-calendar"></i>
					({{ list.created_at * 1000 | date:'yyyy-MM-dd' }})
				</span>
				<span>
					<i class="glyphicon glyphicon-tag"></i>
					<a rel="category tag" href="http://haikun.me/category/%e6%96%87%e7%ab%a0">文章</a>
				</span>
				<span>
					<i class="glyphicon glyphicon-comment"></i>
					<span class="ds-thread-count" data-replace="1" data-thread-key="2171">2</span>
				</span>
			</div>
		</article>
		<div class="page">
			{{$page}}
		</div>
	</div>
</div>
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="../static/common/js/jquery-2.1.3.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../vendor/angularjs/1.4.8/angular.min.js"></script>
<script>
	var app = angular.module('app',[],['$httpProvider',function($httpProvider){
		$httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
		
		/**
		   * The workhorse; converts an object to x-www-form-urlencoded serialization.
		   * @param {Object} obj
		   * @return {String}
		   */ 
		  var param = function(obj) {
		    var query = '', name, value, fullSubName, subName, subValue, innerObj, i;
		      
		    for(name in obj) {
		      value = obj[name];
		        
		      if(value instanceof Array) {
		        for(i=0; i<value.length; ++i) {
		          subValue = value[i];
		          fullSubName = name + '[' + i + ']';
		          innerObj = {};
		          innerObj[fullSubName] = subValue;
		          query += param(innerObj) + '&';
		        }
		      }
		      else if(value instanceof Object) {
		        for(subName in value) {
		          subValue = value[subName];
		          fullSubName = name + '[' + subName + ']';
		          innerObj = {};
		          innerObj[fullSubName] = subValue;
		          query += param(innerObj) + '&';
		        }
		      }
		      else if(value !== undefined && value !== null)
		        query += encodeURIComponent(name) + '=' + encodeURIComponent(value) + '&';
		    }
		      
		    return query.length ? query.substr(0, query.length - 1) : query;
		  };

		  // Override $http service's default transformRequest
		  $httpProvider.defaults.transformRequest = [function(data) {
		    return angular.isObject(data) && String(data) !== '[object File]' ? param(data) : data;
		  }];
	}]);
	//factory 使用于功能简单，类似于单例的一样，service适用于逻辑处理比较复杂的方法
	app.factory('documentListFactory',['$http','$q',function($http,$q){
		//申明一个延迟
		var deferred = $q.defer();
		$http.get('http://3.cs/index.php?_json=1&_content=1').success(function(response){
			deferred.resolve(response);
		}).error(function(response){
			deferred.reject(response);
		});
		// 返回承诺，这里并不是最终数据，而是访问最终数据的API 
		return deferred.promise;   
	}]);
	
	app.factory('documentTagsFactory',['$http','$q','documentListFactory',function($http,$q,documentListFactory){
		//申明一个延迟
		return {
			query(ids)
			{
				var a = [];
				
				documentListFactory.then(function(response){
					console.log(response);
					angular.forEach(response.data.models,function(values){
						a.push(values.id);
					});
				});
				console.log(a);
				
				var deferred = $q.defer();
				$http.post('http://3.cs/index.php/tags/assoc-tags',{
					'id':a,
					'model':'Simon\\Document\\Models\\Document'
				}).success(function(response){
					deferred.resolve(response);
				}).error(function(response){
					deferred.reject(response);
				});
				return deferred.promise;
			}
		}
	}]);
	
	app.controller('listController',['$scope','$http','$q','documentListFactory','documentTagsFactory',function($scope,$http,$q,documentListFactory,documentTagsFactory){
		
		/* documentListFactory.then(function(response){
			if(response.status == 1000)
			{
				var ids = [];
				
				angular.forEach(response.data.models,function(values){
					ids.push(values.id);
				});
				
				documentTagsFactory.query(ids).then(function(response){
					console.log(response);
				});
			}
		}); */
		/* documentListFactory.then(function(data){
			
		}) */
		documentTagsFactory.query().then(function(data){
			
		});
	}]);
	
	
	
	
	
	$(function(){
		/* $.get('http://3.cs/index.php?_json=1&_content=1',function(data){
			console.log(data);
		}) */
	})
</script>

<!-- 

app.controller('listController',['$scope','$http','$q','documentListFactory','documentTagsFactory',function($scope,$http,$q,documentListFactory,documentTagsFactory){
		
		documentListFactory.then(function(data){
			console.log(data);
		});
		
		//var promise = documentListFactory;
		//then方法// 调用承诺API获取数据
		//var documentList = {};
		//var tagsList = {};
		/*documentListFactory.then(function(data){
			documentList = data.data.models;
			console.log(1);
		});*/
		
		/*documentTagsFactory.query().then(function(data){
			console.log(documentList);
			console.log(2);
		});*/
		
		//$q.when(documentListFactory).then(function(data){
		//	console.log(data);
		//	console.log(2);
		//});
		$scope.tags = 'abc';
		var promise = $q.all([documentListFactory,documentTagsFactory.query(documentListFactory)]);
		
		promise.then(function(data){
		//console.log(data);
			//console.log(documentList);
			//console.log(3);
			//$scope.tags = 'aaaaaaa';
		});
		
		
		
		
		
		console.log($scope.tags);
		/* $http.get('http://3.cs/index.php?_json=1&_content=1').success(function(response){
			$scope.lists = response.data.models;
			$scope.page = response.data.page;
		});
		console.log($scope);
		console.log($http); */
	}]);
 -->

</body>
</html>